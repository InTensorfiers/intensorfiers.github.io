# Streamlined Ansible Playbook Installation

In the upcoming code examples, we're sharing a complete Ansible playbook that helps you through the entire project process. It covers everything from setting up the virtual machine to installing important libraries and dependencies.

The source code of the playbook is available [here](https://github.com/InTensorfiers/GPU-config-with-Ansible/blob/local-replication/playbook.yaml).

## 

## Configuration through `inventory.yaml`

For higher degree of customization, we have written the script in the way that multiple variables can be configured during the installation. This includes:
- Python version for the conda environment to have
- Miniconda's version to be installed
- Name of the conda environment to be created

These configurations can be customized by the use of `inventory.yaml`. We have already provided [a template of this file on the Github repo](https://github.com/InTensorfiers/GPU-config-with-Ansible/blob/local-replication/inventory.yaml.template).

<iframe
  src="https://carbon.now.sh/embed?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=seti&wt=none&l=yaml&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=vms%253A%250A%2520%2520hosts%253A%250A%2520%2520%2520%2520intensorfier%253A%250A%2520%2520%2520%2520%2520%2520ansible_host%253A%25201.1.1.1%2520%2523%2520change%2520this%250A%2520%2520%2520%2520%2520%2520python_version%253A%25203.9%250A%2520%2520%2520%2520%2520%2520conda_version%253A%252023.5.2%250A%2520%2520%2520%2520%2520%2520conda_env_name%253A%2520intensorfiers"
  style="width: 496px; height: 316px; border:0; transform: scale(1); overflow:hidden;"
  sandbox="allow-scripts allow-same-origin">
</iframe>

## Components of the playbook

The playbook is organized into blocks; Each block serve a specific function:

### Installing Nvidia Drivers

This section of the playbook focuses on automating the installation of Nvidia graphics drivers. It downloads the Python script from our repo to ensure compatible driver are installed on the system to enable GPU acceleration for machine learning tasks.

<iframe
  src="https://carbon.now.sh/embed?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=seti&wt=none&l=yaml&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%2509-%2520name%253A%2520Install%2520GPU%2520server%250A%2520%2520%2520%2520%2520%2520block%253A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Ensure%2520Python3%2520is%2520installed%250A%2520%2520%2520%2520%2520%2520%2520%2520package%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520name%253A%2520python3%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520state%253A%2520present%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Download%2520the%2520installation%2520script%250A%2520%2520%2520%2520%2520%2520%2520%2520get_url%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520url%253A%2520https%253A%252F%252Fraw.githubusercontent.com%252FInTensorfiers%252Fcompute-gpu-installation%252Fmain%252Flinux%252Finstall_gpu_driver.py%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520dest%253A%2520%252Ftmp%252Finstall_gpu_driver.py%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Run%2520the%2520installation%2520script%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520python3%2520%252Ftmp%252Finstall_gpu_driver.py%250A%2520%2520%2520%2520%2520%2520%2520%2520args%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520creates%253A%2520%252Fusr%252Fbin%252Fnvidia-smi%2520%2520%2523%2520Check%2520if%2520nvidia-smi%2520is%2520already%2520installed%250A%2520%2520%2520%2520%2520%2520%2520%2520register%253A%2520install_output%250A%2520%2520%2520%2520%2520%2520%2520%2520ignore_errors%253A%2520yes%2520%2520%2523%2520Ignore%2520errors%2520since%2520the%2520script%2520might%2520restart%2520the%2520VM%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Verify%2520the%2520installation%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520sudo%2520nvidia-smi%2520%2520%2520%2523%2520we%2520can%2520do%2520this%2520in%2520the%2520VM%2520to%2520confirm%2520installation"
  style="width: 1024px; height: 596px; border:0; transform: scale(1); overflow:hidden;"
  sandbox="allow-scripts allow-same-origin">
</iframe>

### Installing Conda via Miniconda

In this part of the playbook, the automation process involves installing Miniconda, a minimal version of Conda. This step lays the foundation for creating isolated environments and managing dependencies efficiently.

<iframe
  src="https://carbon.now.sh/embed?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=seti&wt=none&l=yaml&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%2520%2520%2520%2520-%2520name%253A%2520Install%2520miniconda%250A%2520%2520%2520%2520%2520%2520block%253A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Include%2520the%2520input%2520for%2520the%2520python%2520version%2520and%2520the%2520CPU%2520architecture%250A%2520%2520%2520%2520%2520%2520%2520%2520set_fact%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520cpu_arch%253A%2520%2522%257B%257B%2520ansible_architecture%2520%257C%2520default%28%27x86_64%27%29%2520%257D%257D%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Download%2520Miniconda%250A%2520%2520%2520%2520%2520%2520%2520%2520get_url%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520url%253A%2520%2522https%253A%252F%252Frepo.anaconda.com%252Fminiconda%252FMiniconda3-latest-Linux-%257B%257B%2520cpu_arch%2520%257D%257D.sh%2522%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520dest%253A%2520%2522%257B%257B%2520ansible_env.HOME%2520%257D%257D%252Fminiconda.sh%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Installing%2520Miniconda%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%2522bash%2520%257B%257B%2520ansible_env.HOME%2520%257D%257D%252Fminiconda.sh%2520-b%2520-p%2520%257B%257B%2520ansible_env.HOME%2520%257D%257D%252Fminiconda%2522%250A%2520%2520%2520%2520%2520%2520%2520%2520args%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520creates%253A%2520%2522%257B%257B%2520ansible_env.HOME%2520%257D%257D%252Fminiconda%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Adding%2520Miniconda%2520to%2520the%2520system%2520path%250A%2520%2520%2520%2520%2520%2520%2520%2520lineinfile%253A%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520path%253A%2520%2522%257B%257B%2520ansible_env.HOME%2520%257D%257D%252F.bashrc%2522%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520line%253A%2520%27export%2520PATH%253D%2522%257B%257B%2520ansible_env.HOME%2520%257D%257D%252Fminiconda%252Fbin%253A%2524PATH%2522%27%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520state%253A%2520present%250A%2520%2520%2520%2520%2520%2520%2520%2520register%253A%2520lineinfile_result%250A%2520%2520%2520%2520%2520%2520%2520%2520changed_when%253A%2520lineinfile_result%2520is%2520changed%250A"
  style="width: 959px; height: 633px; border:0; transform: scale(1); overflow:hidden;"
  sandbox="allow-scripts allow-same-origin">
</iframe>

### Creating a New Conda Environment and Installing All Dependencies

This section handles the creation of a new Conda environment, which acts as an isolated workspace for the project. The playbook then proceeds to automatically install all the necessary dependencies required for running machine learning workloads within this environment.

<iframe
  src="https://carbon.now.sh/embed?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=seti&wt=none&l=yaml&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%2520%2520%2520%2520-%2520name%253A%2520Create%2520conda%2520environment%2520with%2520all%2520libraries%250A%2520%2520%2520%2520%2520%2520block%253A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Update%2520conda%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520%252Froot%252Fminiconda%252Fbin%252Fconda%2520update%2520-n%2520base%2520-c%2520defaults%2520conda%2520-y%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Run%2520conda%2520init%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520%252Froot%252Fminiconda%252Fbin%252Fconda%2520init%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Creating%2520Conda%2520environment%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%2522%252Froot%252Fminiconda%252Fbin%252Fconda%2520create%2520-y%2520-n%2520%257B%257B%2520conda_env_name%2520%257D%257D%2520python%253D%257B%257B%2520python_version%2520%257D%257D%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Activate%2520the%2520created%2520Conda%2520environment%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%2522%252Froot%252Fminiconda%252Fbin%252Factivate%2520%257B%257B%2520conda_env_name%2520%257D%257D%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Install%2520CUDA%2520Toolkit%2520in%2520conda%2520environment%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520%252Froot%252Fminiconda%252Fbin%252Fconda%2520install%2520-n%2520%257B%257B%2520conda_env_name%2520%257D%257D%2520-c%2520conda-forge%2520cudatoolkit%253D11.8.0%2520-y%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Install%2520cuDNN%2520and%2520tensorflow%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%2522%257B%257B%2520conda_prefix%2520%257D%257D%252Fbin%252Fpip%2520install%2520nvidia-cudnn-cu11%253D%253D8.6.0.163%2520tensorflow%253D%253D2.13.*%2522%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Add%2520cuDNN%2520path%2520into%2520conda%2520environment%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%257C%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520mkdir%2520-p%2520%257B%257B%2520conda_prefix%2520%257D%257D%252Fetc%252Fconda%252Factivate.d%2520%2526%2526%2520%255C%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520echo%2520%27CUDNN_PATH%253D%2524%28dirname%2520%2524%28python%2520-c%2520%2522import%2520nvidia.cudnn%253Bprint%28nvidia.cudnn.__file__%29%2522%29%29%27%2520%253E%253E%2520%257B%257B%2520conda_prefix%2520%257D%257D%252Fetc%252Fconda%252Factivate.d%252Fenv_vars.sh%2520%2526%2526%2520%255C%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520echo%2520%27export%2520LD_LIBRARY_PATH%253D%2524LD_LIBRARY_PATH%253A%257B%257B%2520conda_prefix%2520%257D%257D%252Flib%252F%253A%2524CUDNN_PATH%252Flib%27%2520%253E%253E%2520%257B%257B%2520conda_prefix%2520%257D%257D%252Fetc%252Fconda%252Factivate.d%252Fenv_vars.sh%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Install%2520Jupyter%2520suite%2520in%2520conda%2520environment%250A%2520%2520%2520%2520%2520%2520%2520%2520command%253A%2520%252Froot%252Fminiconda%252Fbin%252Fconda%2520install%2520-n%2520%257B%257B%2520conda_env_name%2520%257D%257D%2520-c%2520anaconda%2520jupyter%2520-y%250A%250A%2520%2520%2520%2520%2520%2520-%2520name%253A%2520Install%2520other%2520essential%2520libraries%250A%2520%2520%2520%2520%2520%2520%2520%2520shell%253A%2520%2522%257B%257B%2520conda_prefix%2520%257D%257D%252Fbin%252Fpip%2520install%2520numpy%2520pandas%2520scikit-learn%2520xgboost%2520scipy%2520matplotlib%2520seaborn%2520chardet%2522"
  style="width: 1024px; height: 856px; border:0; transform: scale(1); overflow:hidden;"
  sandbox="allow-scripts allow-same-origin">
</iframe>